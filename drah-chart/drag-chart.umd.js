(function(v,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("vue"),require("dayjs"),require("echarts")):typeof define=="function"&&define.amd?define(["exports","vue","dayjs","echarts"],r):(v=typeof globalThis<"u"?globalThis:v||self,r(v.DragChart={},v.Vue,v.dayjs,v.echarts))})(this,function(v,r,m,P){"use strict";function Y(s){const l=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(s){for(const t in s)if(t!=="default"){const g=Object.getOwnPropertyDescriptor(s,t);Object.defineProperty(l,t,g.get?g:{enumerable:!0,get:()=>s[t]})}}return l.default=s,Object.freeze(l)}const F=Y(P);function B(s){return r.getCurrentScope()?(r.onScopeDispose(s),!0):!1}const H=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const W=H?window:void 0;function R(s){var l;const t=r.toValue(s);return(l=t?.$el)!=null?l:t}function V(){const s=r.shallowRef(!1),l=r.getCurrentInstance();return l&&r.onMounted(()=>{s.value=!0},l),s}function Z(s){const l=V();return r.computed(()=>(l.value,!!s()))}function N(s,l,t={}){const{window:g=W,...y}=t;let i;const n=Z(()=>g&&"ResizeObserver"in g),O=()=>{i&&(i.disconnect(),i=void 0)},d=r.computed(()=>{const b=r.toValue(s);return Array.isArray(b)?b.map(x=>R(x)):[R(b)]}),w=r.watch(d,b=>{if(O(),n.value&&g){i=new ResizeObserver(l);for(const x of b)x&&i.observe(x,y)}},{immediate:!0,flush:"post"}),M=()=>{O(),w()};return B(M),{isSupported:n,stop:M}}const q={class:"chart-container"},K=r.defineComponent({name:"DragChart"}),X=r.defineComponent({...K,props:{timeRange:{type:Array,default:()=>[m(),m()]},startIcon:{type:String,default:"https://img.icons8.com/material-outlined/24/000000/left2.png"},endIcon:{type:String,default:"https://img.icons8.com/material-outlined/24/000000/right2.png"},symbolSize:{type:Number,default:20},valueData:{type:Array,default:()=>[]},activeTime:{type:Array,default:()=>[0,12]},interval:{type:Number,default:4},autoInterval:{type:Boolean,default:!0}},emits:["update:activeTime"],setup(s,{emit:l}){const t=s,g=l,y=r.ref();let i;const n=r.ref([[10,0],[20,0]]);N(y,()=>{i&&i.resize({width:"auto",height:"auto"})});const d=r.computed(()=>24*t.timeRange.length-1),w=r.computed(()=>{const e=[],o=m(t.timeRange[0]),c=m(t.timeRange[t.timeRange.length-1]).diff(o,"day");for(let p=0;p<=c;p++){const h=o.add(p,"day");for(let u=0;u<24;u++)e.push(h.hour(u).format("YYYY-MM-DD HH:mm:ss"))}return e}),M=r.computed(()=>Math.floor((d.value-1)/12)+1),b=r.computed(()=>!t.valueData||t.valueData.length===0?[]:t.valueData.reduce((o,a)=>{const c=o[o.length-1];return c&&m(c).hour()===m(a).hour()?o:[...o,m(a).set("minute",0).set("second",0).format("YYYY-MM-DD HH:mm:ss")]},[])),x=(e,o)=>{const a=[];for(let c=e;c<=o;c+=1)a.push([c,2]);return a},S=()=>{i.setOption({graphic:n.value.map(e=>({position:i.convertToPixel("grid",e)}))})},U=e=>{i.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:e})},J=()=>{i.dispatchAction({type:"hideTip"})},D=()=>{const e=Math.min(n.value[0][0],n.value[1][0]),o=Math.max(n.value[0][0],n.value[1][0]),a=x(e,o),c=n.value[0][0],p=n.value[1][0],h=c<p;i.setOption({series:[{id:"a",data:n.value,z:80,silent:!0,animation:!1,symbolSize:20},{id:"b",data:a,type:"line",areaStyle:{color:"rgba(160,210,255,0.14)"},symbolSize:0,markLine:A(a),z:90,silent:!0,animation:!1}]}),i.setOption({graphic:n.value.map((u,f)=>({position:i.convertToPixel("grid",u),type:"image",style:{image:(h?f===0:f===1)?t.startIcon:t.endIcon,width:t.symbolSize,height:t.symbolSize,x:-t.symbolSize/2,y:-t.symbolSize/2},invisible:!1,z:100}))})},T=()=>{g("update:activeTime",n.value.map(e=>w.value[e[0]]))},Q=(e,o)=>{const a=i.convertFromPixel("grid",o);a[0]=Math.round(Math.min(Math.max(a[0],0),d.value)),a[1]=n.value[e][1],n.value[e]=a,D(),T()},j=(e,o)=>{const a=i.convertFromPixel("grid",o);a[0]=Math.min(Math.max(a[0],0),d.value),a[1]=n.value[e][1],n.value[e]=a,D()},k=e=>{if(!e.ctrlKey&&!e.shiftKey)return;e.preventDefault();const o=e.deltaY,a=Math.abs(n.value[1][0]-n.value[0][0]);if(e.shiftKey){const I=o>0?2:-2;let z=n.value[0][0]+I,_=n.value[1][0]+I;z<0&&(z=0,_=a),_>d.value&&(_=d.value,z=d.value-a),n.value=[[z,0],[_,0]],D(),T();return}const c=.1;if(a<=4&&o>0)return;let p=o>0?Math.min(d.value,a*(1+c)):Math.max(4,a*(1-c));const h=(n.value[0][0]+n.value[1][0])/2;let u=Math.round(h-p/2),f=Math.round(h+p/2);u<0&&(u=0,f=Math.min(d.value,Math.round(p))),f>d.value&&(f=d.value,u=Math.max(0,Math.round(d.value-p))),!(f-u<4)&&(n.value=[[u,0],[f,0]],D(),T())},E=()=>{const e=Math.min(n.value[0][0],n.value[1][0]),o=Math.max(n.value[0][0],n.value[1][0]),a=x(e,o),c=b.value.map(h=>[w.value.findIndex(f=>m(f).isSame(m(h),"hour")),1]),p=[{id:"b",type:"line",data:a,areaStyle:{color:"rgba(160,210,255,0.14)"},lineStyle:{color:"#5CB0FE",width:1},symbol:"none",markLine:A(a),z:100,silent:!0,animation:!1},{id:"c",type:"bar",data:c,barWidth:20,itemStyle:{color:"#C2E2FF",borderRadius:[3,3,0,0]},z:0,silent:!0,animation:!1}];return{tooltip:{triggerOn:"none",formatter:function(h){const u=w.value[Math.round(h.data[0])];return m(u).format("MM/DD HH:mm")}},grid:{top:"50%",left:"17",right:"20"},xAxis:{min:0,max:d.value,interval:t.autoInterval?M.value:t.interval,type:"value",axisLine:{onZero:!1},axisTick:{inside:!0},splitLine:{show:!1},axisLabel:{formatter:function(h){let u=w.value[h];const f=m(u).hour();return f==0?`{datebox|}{date|${m(u).format("MM/DD")}}`:`{time|${f}:00}`},rich:{datebox:{width:40},date:{color:"#333333",backgroundColor:"rgba(51,51,51,0.08)",padding:4,borderRadius:10},time:{color:"#666"}}}},yAxis:{type:"value",axisLine:{show:!1},axisLabel:{show:!1},axisTick:{show:!1},splitLine:{show:!1}},series:[{id:"a",type:"line",smooth:!0,data:n.value,areaStyle:{},symbolSize:20},...p]}},A=e=>({symbol:"none",animation:!1,z:0,lineStyle:{color:"#5CB0FE",width:1,type:"solid"},data:[[{coord:[e[0][0],0]},{coord:[e[0][0],e[0][1]]}],[{coord:[e[e.length-1][0],0]},{coord:[e[e.length-1][0],e[e.length-1][1]]}]]}),L=e=>{const o=[e.offsetX,e.offsetY];i.convertFromPixel({seriesIndex:0},o)};return r.onMounted(()=>{i=F.init(y.value,null,{renderer:"svg"}),i.setOption(E()),setTimeout(()=>{i.setOption({graphic:n.value.map((e,o)=>({type:"image",position:i.convertToPixel("grid",e),style:{image:o===0?t.startIcon:t.endIcon,width:t.symbolSize,height:t.symbolSize,x:-t.symbolSize/2,y:-t.symbolSize/2},invisible:!1,draggable:"horizontal",ondrag:function(a,c){j(o,[this.x,this.y])},ondragend:function(){Q(o,[this.x,this.y])},onmousemove:function(){U(o)},onmouseout:function(){J()},z:200}))})},0),window.addEventListener("resize",S),i.on("dataZoom",S),i.getZr().on("click",L),y.value.addEventListener("wheel",k,{passive:!1})}),r.onBeforeUnmount(()=>{window.removeEventListener("resize",S),i.off("dataZoom",S),i.getZr().off("click",L),y.value?.removeEventListener("wheel",k)}),r.watch(()=>t.timeRange,e=>{i&&(i.setOption(E()),S())},{immediate:!0}),(e,o)=>(r.openBlock(),r.createElementBlock("div",q,[r.createElementVNode("div",{ref_key:"chartRef",ref:y,class:"chart-wrap"},null,512)]))}}),C=((s,l)=>{const t=s.__vccOpts||s;for(const[g,y]of l)t[g]=y;return t})(X,[["__scopeId","data-v-eb36b0a0"]]),$=[C],G={install:s=>{$.forEach(l=>{s.component(l.name,l)})}};v.DragChart=C,v.default=G,Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
