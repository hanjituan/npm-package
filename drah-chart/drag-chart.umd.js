(function(g,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("vue"),require("dayjs"),require("echarts")):typeof define=="function"&&define.amd?define(["exports","vue","dayjs","echarts"],r):(g=typeof globalThis<"u"?globalThis:g||self,r(g.DragChart={},g.Vue,g.dayjs,g.echarts))})(this,function(g,r,c,Y){"use strict";function F(s){const l=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(s){for(const t in s)if(t!=="default"){const v=Object.getOwnPropertyDescriptor(s,t);Object.defineProperty(l,t,v.get?v:{enumerable:!0,get:()=>s[t]})}}return l.default=s,Object.freeze(l)}const B=F(Y);function H(s){return r.getCurrentScope()?(r.onScopeDispose(s),!0):!1}const W=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const V=W?window:void 0;function R(s){var l;const t=r.toValue(s);return(l=t?.$el)!=null?l:t}function Z(){const s=r.shallowRef(!1),l=r.getCurrentInstance();return l&&r.onMounted(()=>{s.value=!0},l),s}function N(s){const l=Z();return r.computed(()=>(l.value,!!s()))}function q(s,l,t={}){const{window:v=V,...b}=t;let i;const f=N(()=>v&&"ResizeObserver"in v),y=()=>{i&&(i.disconnect(),i=void 0)},o=r.computed(()=>{const x=r.toValue(s);return Array.isArray(x)?x.map(w=>R(w)):[R(x)]}),_=r.watch(o,x=>{if(y(),f.value&&v){i=new ResizeObserver(l);for(const w of x)w&&i.observe(w,b)}},{immediate:!0,flush:"post"}),T=()=>{y(),_()};return H(T),{isSupported:f,stop:T}}const G={class:"chart-container"},K=r.defineComponent({name:"DragChart"}),X=r.defineComponent({...K,props:{timeRange:{type:Array,default:()=>[c().subtract(1,"day"),c()]},startIcon:{type:String,default:"https://img.icons8.com/material-outlined/24/000000/left2.png"},endIcon:{type:String,default:"https://img.icons8.com/material-outlined/24/000000/right2.png"},symbolSize:{type:Number,default:20},valueData:{type:Array,default:()=>[]},activeTime:{type:Array,default:()=>[0,12]},interval:{type:Number,default:4},autoInterval:{type:Boolean,default:!0}},emits:["update:activeTime"],setup(s,{emit:l}){const t=s,v=l,b=r.ref();let i;const f=r.computed(()=>24*t.timeRange.length-1),y=r.computed(()=>{const e=[],a=c(t.timeRange[0]),d=c(t.timeRange[t.timeRange.length-1]).diff(a,"day");for(let p=0;p<=d;p++){const h=a.add(p,"day");for(let u=0;u<24;u++)e.push(h.hour(u).format("YYYY-MM-DD HH:00:00"))}return e}),o=r.computed({get(){return _()},set(e){v("update:activeTime",e)}}),_=()=>{if(!t.activeTime||t.activeTime.length!==2)return[[0,0],[y.value.length-1,0]];const e=y.value.findIndex(n=>c(n).isSame(c(t.activeTime[0]),"hour")),a=y.value.findIndex(n=>c(n).isSame(c(t.activeTime[1]),"hour"));return[[e,0],[a,0]]};q(b,()=>{i&&i.resize({width:"auto",height:"auto"})});const x=r.computed(()=>Math.floor((f.value-1)/12)+1),w=r.computed(()=>!t.valueData||t.valueData.length===0?[]:t.valueData.reduce((a,n)=>{const d=a[a.length-1];return d&&c(d).hour()===c(n).hour()?a:[...a,c(n).set("minute",0).set("second",0).format("YYYY-MM-DD HH:mm:ss")]},[])),k=(e,a)=>{const n=[];for(let d=e;d<=a;d+=1)n.push([d,2]);return n},S=()=>{i.setOption({graphic:o.value.map(e=>({position:i.convertToPixel("grid",e)}))})},J=e=>{i.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:e})},Q=()=>{i.dispatchAction({type:"hideTip"})},M=()=>{const e=Math.min(o.value[0][0],o.value[1][0]),a=Math.max(o.value[0][0],o.value[1][0]),n=k(e,a),d=o.value[0][0],p=o.value[1][0],h=d<p;i.setOption({series:[{id:"a",data:o.value,z:80,silent:!0,animation:!1,symbolSize:20},{id:"b",data:n,type:"line",areaStyle:{color:"rgba(160,210,255,0.14)"},symbolSize:0,markLine:A(n),z:90,silent:!0,animation:!1}]}),i.setOption({graphic:o.value.map((u,m)=>({position:i.convertToPixel("grid",u),type:"image",style:{image:(h?m===0:m===1)?t.startIcon:t.endIcon,width:t.symbolSize,height:t.symbolSize,x:-t.symbolSize/2,y:-t.symbolSize/2},invisible:!1,z:100}))})},O=()=>{v("update:activeTime",o.value.map(e=>y.value[e[0]]))},j=(e,a)=>{const n=i.convertFromPixel("grid",a);n[0]=Math.round(Math.min(Math.max(n[0],0),f.value)),n[1]=o.value[e][1],o.value[e]=n,M(),O()},ee=(e,a)=>{const n=i.convertFromPixel("grid",a);n[0]=Math.min(Math.max(n[0],0),f.value),n[1]=o.value[e][1],o.value[e]=n,M()},E=e=>{if(!e.ctrlKey&&!e.shiftKey)return;e.preventDefault();const a=e.deltaY,n=Math.abs(o.value[1][0]-o.value[0][0]);if(e.shiftKey){const P=a>0?2:-2;let D=o.value[0][0]+P,z=o.value[1][0]+P;D<0&&(D=0,z=n),z>f.value&&(z=f.value,D=f.value-n),o.value[0]=[D,0],o.value[1]=[z,0],M(),O();return}const d=.1;if(n<=4&&a>0)return;let p=a>0?Math.min(f.value,n*(1+d)):Math.max(4,n*(1-d));const h=(o.value[0][0]+o.value[1][0])/2;let u=Math.round(h-p/2),m=Math.round(h+p/2);u<0&&(u=0,m=Math.min(f.value,Math.round(p))),m>f.value&&(m=f.value,u=Math.max(0,Math.round(f.value-p))),!(m-u<4)&&(o.value[0]=[u,0],o.value[1]=[m,0],M(),O())},I=()=>{const e=Math.min(o.value[0][0],o.value[1][0]),a=Math.max(o.value[0][0],o.value[1][0]),n=k(e,a),d=w.value.map(h=>[y.value.findIndex(m=>c(m).isSame(c(h),"hour")),1]),p=[{id:"b",type:"line",data:n,areaStyle:{color:"rgba(160,210,255,0.14)"},lineStyle:{color:"#5CB0FE",width:1},symbol:"none",markLine:A(n),z:100,silent:!0,animation:!1},{id:"c",type:"bar",data:d,barWidth:20,itemStyle:{color:"#C2E2FF",borderRadius:[3,3,0,0]},z:0,silent:!0,animation:!1}];return{tooltip:{triggerOn:"none",formatter:function(h){const u=y.value[Math.round(h.data[0])];return c(u).format("MM/DD HH:mm")}},grid:{top:"50%",left:"50",right:"50"},xAxis:{min:0,max:f.value,interval:t.autoInterval?x.value:t.interval,type:"value",boundaryGap:["0%","100%"],axisLine:{onZero:!1},axisTick:{inside:!0},splitLine:{show:!1},axisLabel:{formatter:function(h){let u=y.value[h];const m=c(u).hour();return m==0?`{datebox|}{date|${c(u).format("MM/DD")}}`:`{time|${m}:00}`},rich:{datebox:{width:40},date:{color:"#333333",backgroundColor:"rgba(51,51,51,0.08)",padding:4,borderRadius:10},time:{color:"#666"}}}},yAxis:{type:"value",axisLine:{show:!1},axisLabel:{show:!1},axisTick:{show:!1},splitLine:{show:!1}},series:[{id:"a",type:"line",smooth:!0,data:o.value,areaStyle:{},symbolSize:20},...p]}},A=e=>({symbol:"none",animation:!1,z:0,lineStyle:{color:"#5CB0FE",width:1,type:"solid"},data:[[{coord:[e[0][0],0]},{coord:[e[0][0],e[0][1]]}],[{coord:[e[e.length-1][0],0]},{coord:[e[e.length-1][0],e[e.length-1][1]]}]]}),L=e=>{const a=[e.offsetX,e.offsetY];i.convertFromPixel({seriesIndex:0},a)};return r.onMounted(()=>{i=B.init(b.value,null,{renderer:"svg"}),i.setOption(I()),setTimeout(()=>{i.setOption({graphic:o.value.map((e,a)=>({type:"image",position:i.convertToPixel("grid",e),style:{image:a===0?t.startIcon:t.endIcon,width:t.symbolSize,height:t.symbolSize,x:-t.symbolSize/2,y:-t.symbolSize/2},invisible:!1,draggable:"horizontal",ondrag:function(n,d){ee(a,[this.x,this.y])},ondragend:function(){j(a,[this.x,this.y])},onmousemove:function(){J(a)},onmouseout:function(){Q()},z:200}))})},0),window.addEventListener("resize",S),i.on("dataZoom",S),i.getZr().on("click",L),b.value.addEventListener("wheel",E,{passive:!1})}),r.onBeforeUnmount(()=>{window.removeEventListener("resize",S),i.off("dataZoom",S),i.getZr().off("click",L),b.value?.removeEventListener("wheel",E)}),r.watch(()=>t.timeRange,e=>{i&&(i.setOption(I()),S())},{immediate:!0}),(e,a)=>(r.openBlock(),r.createElementBlock("div",G,[r.createElementVNode("div",{ref_key:"chartRef",ref:b,class:"chart-wrap"},null,512)]))}}),C=((s,l)=>{const t=s.__vccOpts||s;for(const[v,b]of l)t[v]=b;return t})(X,[["__scopeId","data-v-ec1e5d9c"]]),$=[C],U={install:s=>{$.forEach(l=>{s.component(l.name,l)})}};g.DragChart=C,g.default=U,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
